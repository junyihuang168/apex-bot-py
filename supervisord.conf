[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
logfile_backups=0
pidfile=/tmp/supervisord.pid

; =====================
; WEB (Flask/Gunicorn)
; =====================
[program:web]
; Web 服务模块：默认使用 app.py (module "app")
; 如果你仓库里不是 app.py，而是别的文件名（例如 app_any_amount_v2.py），
; 你可以把下面这一行改成对应的 <module>:app。
command=gunicorn -w 2 -k gthread -t 120 -b 0.0.0.0:%(ENV_PORT)s app:app
environment=ENABLE_WS="0",ENABLE_REST_POLL="0",ENABLE_RISK_LOOP="0",ENABLE_EXCHANGE_STOP="0"
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

; =====================
; WORKER (WS + Risk Loop)
; =====================
[program:worker]
; 关键：worker 必须启动 worker.py（不是 worker_bot_side.py）
command=python worker.py

; 关键：止损/阶梯移动止损需要 ENABLE_RISK_LOOP=1（放在 worker 里）
; Plan A: exchange-native protective STOP_MARKET, triggered by MARK price.
; Use MARK as the single pricing source for risk/ladder logic as well.
environment=ENABLE_WS="1",ENABLE_REST_POLL="1",ENABLE_RISK_LOOP="1",ENABLE_EXCHANGE_STOP="1",STOP_TRIGGER_PRICE_TYPE="MARK",RISK_PRICE_SOURCE="MARK"
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
