; supervisord.conf  (Scheme A: WS/Fills in web process)
;
; Key changes:
; 1) ENABLE_WS=1 for web so the webhook process receives private WS fills.
; 2) gunicorn workers set to 1 to avoid multiple WS connections (each worker is a separate process).
; 3) worker program disabled (autostart=false) and ENABLE_WS=0 to prevent duplicate WS + duplicate accounting.

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
loglevel=info
pidfile=/tmp/supervisord.pid

[program:web]
command=gunicorn -w 1 -k gthread --threads 4 -b 0.0.0.0:%(ENV_PORT)s app:app
autostart=true
autorestart=true
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=ENABLE_WS="1"

[program:worker]
command=python worker.py
autostart=false
autorestart=false
startsecs=2
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=ENABLE_WS="0"
